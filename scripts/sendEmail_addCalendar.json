{"files":[{"id":"d2f8360a-1dda-4e4e-9147-a9bfd8018536","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Argentina/Buenos_Aires\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Calendar\",\n        \"version\": \"v3\",\n        \"serviceId\": \"calendar\"\n      }\n    ]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"30cc5b37-c7ea-4afc-81e4-8ec8c417fd94","name":"Código","type":"server_js","source":"function doPost(e) {\n  Logger.log(JSON.stringify(e));\n  var firstName \u003d e.parameter[\u0027firstName\u0027];\n  var lastName \u003d e.parameter[\u0027lastName\u0027];\n  var email \u003d e.parameter[\u0027email\u0027];\n\n  try {\n    var emailBody \u003d HtmlService.createTemplateFromFile(\u0027confirmationEmail.html\u0027);\n    emailBody.firstName \u003d firstName;\n    emailBody.lastName \u003d lastName;\n    var message \u003d emailBody.evaluate().getContent()\n\n    MailApp.sendEmail({\n      to: email.toString(),\n      subject: \"Confirmación de registro | XXXVII Jornadas Científicas\",\n      htmlBody: message\n    });\n\n\n    //Esta funcion agrega un atendee al evento y evnvia un notification update\n    //definicion de variables\n    var atendeeEmail \u003d email\n    let calendarId \u003d \u0027jornadassantojanni2022@gmail.com\u0027;\n    let eventId \u003d \u002777lqa4ispqope9iapnq6fg32pe\u0027;\n\n    var event \u003d Calendar.Events.get(calendarId, eventId);  //cargamos en la variable event el objeto event\n    Logger.log(event)\n    guests \u003d event.attendees;  //ahora nos traemos la lista de Atendees opcional Logger.log(guests);\n    guests.push({ email: atendeeEmail });  //hacemos un push para agregar el nuevo Atendee opcional Logger.log(guests);\n\n    //preparamos para hacer el Patch\n    var resource \u003d { attendees: guests };\n    var args \u003d { sendUpdates: \"all\" }\n    Calendar.Events.patch(resource, calendarId, eventId, args);\n\n\n    // return json success results\n    return ContentService.createTextOutput(JSON.stringify({ result: \u0027success\u0027 }))\n      .setMimeType(ContentService.MimeType.JSON);\n\n  } catch (error) { // if error return this\n    Logger.log(error);\n    return ContentService\n      .createTextOutput(JSON.stringify({ result: \u0027error\u0027 }))\n      .setMimeType(ContentService.MimeType.JAVASCRIPT);\n  }\n}"},{"id":"7ac8cecc-10ca-495d-8847-080f6aa91554","name":"confirmationEmail","type":"html","source":"\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n  \u003ch2\u003eXXXVII Jornadas Científicas - Hospital Santojanni\u003c/h2\u003e\n  \u003cp\u003e\u003cstrong\u003eHola \u003c?\u003d firstName ?\u003e \u003c?\u003d lastName ?\u003e,\u003c/strong\u003e\u003c/p\u003e\n  \u003cp\u003egracias por tu registro.\u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003eTe recordamos que para completar la inscripción deberás abonar en AMM 1er piso.\u003c/p\u003e\n  \u003cp\u003eTenes tiempo hasta el 31 de octubre.\u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003eTe esperamos!\u003c/p\u003e\n\n\u003c/body\u003e\n\n\u003c/html\u003e\n"}]}