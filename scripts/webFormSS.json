{"files":[{"id":"e069c763-15c1-466b-9c9d-b0a28a242a48","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Argentina/Buenos_Aires\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"efea615d-8baf-44da-8a06-62dd6fad7b56","name":"Código","type":"server_js","source":"\n// Doc de GOOGLE https://developers.google.com/apps-script/guides/content\n\nfunction doPost(e) {\n\n  try {\n    Logger.log(JSON.stringify(e));\n    var date \u003d new Date();\n    var firstName \u003d e.parameter[\u0027firstName\u0027];\n    var lastName \u003d e.parameter[\u0027lastName\u0027];\n    var cell \u003d e.parameter[\u0027cell\u0027];\n    var email \u003d e.parameter[\u0027email\u0027];\n    var servicio \u003d e.parameter[\u0027servicio\u0027];\n    var abono \u003d \u0027NO\u0027;\n\n    var ss \u003d SpreadsheetApp.openById(\u00271nsQyMS-bwCz32FwX8FD3E9MtCG1vFtUfyNxoqRPuS10\u0027);\n    var sheet \u003d ss.getSheets()[0];\n    sheet.appendRow([date, firstName, lastName, cell, email, servicio, abono]);\n\n\n    //send a confirmation email to the user\n    //usando un formato simple de plain text\n    // MailApp.sendEmail({\n    //   to: email.toString(),\n    //   subject: \"Confirmación de Inscripción a las XXXVII Jornadas Científicas\",\n    //   body: \u0027Hola \u0027 + firstName + \u0027,\\nte confirmamos tu inscripción a las XXXVII Jornadas Científicas del Hospital Santojanni.\\n\\nPara completar la inscripción deberás abonar en AMM 1er piso. Tenes tiempo hasta el 31 de octubre.\\n\\nTe esperamos!\\nMuchas gracias.\u0027\n    // });\n\n\n    //https://blog.gsmart.in/google-apps-script-send-html-email/ use this to send HTML email\n    //usando un formato de HTML mail\n    var emailBody \u003d HtmlService.createTemplateFromFile(\u0027confirmationEmail.html\u0027);\n    emailBody.firstName \u003d firstName;\n    var message \u003d emailBody.evaluate().getContent();\n\n\n    MailApp.sendEmail({\n      to: email.toString(),\n      subject: \"Confirmación de registro | XXXVII Jornadas Científicas\",\n      htmlBody: message\n    });\n\n\n    //Esta funcion agrega un atendee al evento y evnvia un notification update\n    //definicion de variables\n    var atendeeEmail \u003d email\n    let calendarId \u003d \u0027jornadassantojanni2022@gmail.com\u0027;\n    let eventId \u003d \u00270u39qi524csus439t50q81fh8a\u0027;\n\n    var event \u003d Calendar.Events.get(calendarId, eventId);  //cargamos en la variable event el objeto event\n    var guests \u003d event.attendees;  //ahora nos traemos la lista de Atendees opcional Logger.log(guests);\n    guests.push({ email: atendeeEmail });  //hacemos un push para agregar el nuevo Atendee opcional Logger.log(guests);\n\n    //preparamos para hacer el Patch\n    var resource \u003d { attendees: guests };\n    var args \u003d { sendUpdates: \"all\" }\n    Calendar.Events.patch(resource, calendarId, eventId, args);\n\n\n    //********************************************************************************************************************************************\n    //send a Whatsapp Reminder\n\n    /*\n      var url \u003d \u0027https://api.twilio.com/2010-04-01/Accounts/AC18a1d161978160b1abaa088bb97371b6/Messages.json\u0027;\n      \n      var options \u003d {\n        \u0027method\u0027: \u0027post\u0027,\n        \u0027headers\u0027: {\n          \u0027Authorization\u0027: \u0027Basic \u0027 + Utilities.base64Encode(\u0027AC18a1d161978160b1abaa088bb97371b6\u0027 + \u0027:\u0027 + \u0027ab5667773777d43ba1466338b39d7fc0\u0027)\n        },\n        \u0027payload\u0027: {\n            \u0027From\u0027: \u0027whatsapp:+16072089628\u0027, \n          //\u0027To\u0027: \u0027whatsapp:+5491162182223\u0027,\n          \u0027To\u0027: \u0027whatsapp:+549\u0027 + cell,\n          \u0027Body\u0027: \u0027Hola \u0027 + firstName + \u0027,\\ngracias por inscribirte a nuestro evento el día 1 de Noviembre.\\n\\nTe esperamos!\u0027\n        },\n        \u0027followRedirects\u0027 : true,\n        \u0027muteHttpExceptions\u0027: true\n      };\n    \n      var response \u003d UrlFetchApp.fetch(url, options);\n    */\n    //********************************************************************************************************************************************\n\n    // return json success results\n    return ContentService.createTextOutput(JSON.stringify({ result: \u0027success\u0027 }))\n      .setMimeType(ContentService.MimeType.JSON);\n\n\n  } catch (error) { // if error return this\n    Logger.log(error);\n    return ContentService\n      .createTextOutput(JSON.stringify({ result: \u0027error\u0027 }))\n      .setMimeType(ContentService.MimeType.JAVASCRIPT);\n  }\n}\n\n\nfunction doGet(e) {\n\n  try {\n    Logger.log(JSON.stringify(e));\n    var email \u003d e.parameter[\u0027email\u0027];\n\n\n    var ss \u003d SpreadsheetApp.openById(\u00271nsQyMS-bwCz32FwX8FD3E9MtCG1vFtUfyNxoqRPuS10\u0027);\n    var sheet \u003d ss.getSheets()[0];\n    var ratesData \u003d sheet.getRange(2, 1, sheet.getLastRow() - 1, 5).getValues()\n    var matchRow \u003d ratesData.find(r \u003d\u003e r[4] \u003d\u003d email)\n    var matchResult \u003d {};\n    if (matchRow \u003d\u003d null) {\n      matchResult[\u0027vlookupResult\u0027] \u003d false\n    } else {\n      matchResult[\u0027vlookupResult\u0027] \u003d true\n    }\n\n\n    // return json success results\n    return ContentService.createTextOutput(JSON.stringify(matchResult))\n      .setMimeType(ContentService.MimeType.JSON);\n\n\n  } catch (error) { // if error return this\n    Logger.log(error);\n    return ContentService\n      .createTextOutput(JSON.stringify({ result: \u0027error\u0027 }))\n      .setMimeType(ContentService.MimeType.JAVASCRIPT);\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"id":"6754d49c-f568-4e76-add1-b1dd8f4752a9","name":"confirmationEmail","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n  \u003cbase target\u003d\"_top\"\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n  \u003ch2\u003eXXXVII Jornadas Científicas - Hospital Santojanni\u003c/h2\u003e\n  \u003cp\u003e\u003cstrong\u003eHola \u003c?\u003d firstName ?\u003e,\u003c/strong\u003e\u003c/p\u003e\n  \u003cp\u003egracias por tu registro.\u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003eTe recordamos que para completar la inscripción deberás abonar en AMM 1er piso.\u003c/p\u003e\n  \u003cp\u003eTenes tiempo hasta el 31 de octubre.\u003c/p\u003e\n  \u003cbr\u003e\n  \u003cp\u003eTe esperamos!\u003c/p\u003e\n\n\u003c/body\u003e\n\n\u003c/html\u003e"}]}